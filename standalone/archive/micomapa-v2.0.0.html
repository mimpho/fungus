<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicoMapa v2.0.0 - Sistema Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
        .font-display { font-family: 'Newsreader', serif; }
        .glass-effect { background: rgba(244, 235, 225, 0.08); backdrop-filter: blur(12px); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(139, 111, 71, 0.3); } 50% { box-shadow: 0 0 30px rgba(139, 111, 71, 0.6); } }
        .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }
        .animate-slide-in { animation: slideIn 0.6s ease-out forwards; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ==================== MOCK DATA ====================
        const mockZonas = [
          { id: 'zona-001', nombre: 'Pinar de Urbi√≥n', provincia: 'Soria', comarca: 'Pinares', latitud: 41.9847, longitud: -2.8547, altitud: 1850, tipo_bosque: 'pinar' },
          { id: 'zona-002', nombre: 'Hayedo del Ripoll√®s', provincia: 'Girona', comarca: 'Ripoll√®s', latitud: 42.2547, longitud: 2.1234, altitud: 1200, tipo_bosque: 'hayedo' },
          { id: 'zona-003', nombre: 'Robledal del Montseny', provincia: 'Barcelona', comarca: 'Osona', latitud: 41.7684, longitud: 2.4153, altitud: 980, tipo_bosque: 'robledal' },
          { id: 'zona-004', nombre: 'Pinar de Lleida', provincia: 'Lleida', comarca: 'Alt Urgell', latitud: 42.3568, longitud: 1.4626, altitud: 1450, tipo_bosque: 'pinar' },
          { id: 'zona-005', nombre: 'Hayedo de la Garrotxa', provincia: 'Girona', comarca: 'Garrotxa', latitud: 42.1547, longitud: 2.5234, altitud: 850, tipo_bosque: 'hayedo' }
        ];

        const mockEspecies = [
          { id: 'esp-001', nombre_cientifico: 'Boletus edulis', nombres_comunes: ['Boleto', 'Cep', 'Sureny', 'Porcino'], familia: 'Boletaceae', comestibilidad: 'excelente', tipos_bosque: ['pinar', 'hayedo', 'robledal'], meses_fructificacion: [8,9,10,11] },
          { id: 'esp-002', nombre_cientifico: 'Lactarius deliciosus', nombres_comunes: ['N√≠scalo', 'Rovell√≥n', 'Pinetell'], familia: 'Russulaceae', comestibilidad: 'excelente', tipos_bosque: ['pinar'], meses_fructificacion: [9,10,11,12] },
          { id: 'esp-003', nombre_cientifico: 'Cantharellus cibarius', nombres_comunes: ['Rebozuelo', 'Chantarela', 'Camagroc'], familia: 'Cantharellaceae', comestibilidad: 'excelente', tipos_bosque: ['hayedo', 'robledal'], meses_fructificacion: [6,7,8,9,10] },
          { id: 'esp-004', nombre_cientifico: 'Amanita caesarea', nombres_comunes: ['Oronja', 'Ou de reig'], familia: 'Amanitaceae', comestibilidad: 'excelente', tipos_bosque: ['robledal'], meses_fructificacion: [7,8,9,10] },
          { id: 'esp-005', nombre_cientifico: 'Amanita muscaria', nombres_comunes: ['Matamoscas', 'Reig bord'], familia: 'Amanitaceae', comestibilidad: 'toxico', tipos_bosque: ['pinar', 'hayedo'], meses_fructificacion: [8,9,10,11] }
        ];

        const mockOportunidades = [
          { zona_id: 'zona-001', zona_nombre: 'Pinar de Urbi√≥n', provincia: 'Soria', especie_id: 'esp-001', nombre_cientifico: 'Boletus edulis', score_total: 92.5, probabilidad: 'excelente', dias_estimados_fructificacion: 5 },
          { zona_id: 'zona-002', zona_nombre: 'Hayedo del Ripoll√®s', provincia: 'Girona', especie_id: 'esp-003', nombre_cientifico: 'Cantharellus cibarius', score_total: 88.3, probabilidad: 'excelente', dias_estimados_fructificacion: 7 },
          { zona_id: 'zona-004', zona_nombre: 'Pinar de Lleida', provincia: 'Lleida', especie_id: 'esp-002', nombre_cientifico: 'Lactarius deliciosus', score_total: 85.7, probabilidad: 'muy_alta', dias_estimados_fructificacion: 4 },
          { zona_id: 'zona-003', zona_nombre: 'Robledal del Montseny', provincia: 'Barcelona', especie_id: 'esp-004', nombre_cientifico: 'Amanita caesarea', score_total: 82.1, probabilidad: 'muy_alta', dias_estimados_fructificacion: 8 }
        ];

        // Icons
        const MapPin = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>;
        const Cloud = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" /></svg>;
        const Droplets = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>;
        const TrendingUp = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>;
        const Filter = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" /></svg>;
        const Bell = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>;

        // ==================== APP PRINCIPAL ====================
        function App() {
          const [view, setView] = useState('dashboard');
          const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
          const [selectedZona, setSelectedZona] = useState(null);
          const [selectedEspecie, setSelectedEspecie] = useState(null);
          const [zonasSeguidas, setZonasSeguidas] = useState([]);

          useEffect(() => {
            const saved = localStorage.getItem('micomapa_seguimiento_v2');
            if (saved) {
              setZonasSeguidas(JSON.parse(saved));
            } else {
              setZonasSeguidas([mockZonas[0], mockZonas[1]]);
            }
          }, []);

          useEffect(() => {
            if (zonasSeguidas.length > 0) {
              localStorage.setItem('micomapa_seguimiento_v2', JSON.stringify(zonasSeguidas));
            }
          }, [zonasSeguidas]);

          return (
            <div className="min-h-screen bg-gradient-to-br from-[#1a3a2e] via-[#2d4a3e] to-[#1a3a2e]">
              <Header view={view} setView={setView} mobileMenuOpen={mobileMenuOpen} setMobileMenuOpen={setMobileMenuOpen} zonasSeguidas={zonasSeguidas} />
              <main className="container mx-auto px-4 py-8 max-w-7xl">
                {view === 'dashboard' && <Dashboard setView={setView} setSelectedZona={setSelectedZona} />}
                {view === 'seguimiento' && <Seguimiento zonasSeguidas={zonasSeguidas} setZonasSeguidas={setZonasSeguidas} setSelectedZona={setSelectedZona} />}
                {view === 'zonas' && <Zonas zonasSeguidas={zonasSeguidas} setZonasSeguidas={setZonasSeguidas} setSelectedZona={setSelectedZona} />}
                {view === 'especies' && <Especies setSelectedEspecie={setSelectedEspecie} />}
              </main>
              {selectedZona && <ZonaModal zona={selectedZona} onClose={() => setSelectedZona(null)} />}
              {selectedEspecie && <EspecieModal especie={selectedEspecie} onClose={() => setSelectedEspecie(null)} />}
            </div>
          );
        }

        // ==================== HEADER ====================
        function Header({ view, setView, mobileMenuOpen, setMobileMenuOpen, zonasSeguidas }) {
          const navItems = [
            { id: 'dashboard', label: 'Dashboard', icon: TrendingUp },
            { id: 'seguimiento', label: 'Seguimiento', icon: Bell, badge: zonasSeguidas.length },
            { id: 'zonas', label: 'Zonas', icon: MapPin },
            { id: 'especies', label: 'Especies', icon: Filter }
          ];

          return (
            <header className="glass-effect border-b border-[#8b6f47]/20">
              <div className="container mx-auto px-4 py-6 max-w-7xl">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-4 animate-slide-in">
                    <div className="w-14 h-14 rounded-full bg-gradient-to-br from-[#8b6f47] to-[#4a7c59] flex items-center justify-center text-3xl shadow-lg">üçÑ</div>
                    <div>
                      <h1 className="font-display text-3xl font-bold text-[#f4ebe1]">MicoMapa</h1>
                      <p className="text-[#f4ebe1]/60 text-sm">v2.0.0 - Sistema Completo</p>
                    </div>
                  </div>

                  <nav className="hidden md:flex gap-2">
                    {navItems.map(({ id, label, icon: Icon, badge }) => (
                      <button key={id} onClick={() => setView(id)} className={`px-5 py-2.5 rounded-xl font-medium transition-all duration-300 flex items-center gap-2 ${view === id ? 'bg-[#8b6f47] text-white shadow-lg scale-105' : 'text-[#f4ebe1]/80 hover:bg-white/10 hover:text-[#f4ebe1]'}`}>
                        <Icon />
                        {label}
                        {badge > 0 && <span className="ml-1 px-2 py-0.5 bg-[#059669] text-white rounded-full text-xs font-bold">{badge}</span>}
                      </button>
                    ))}
                  </nav>

                  <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="md:hidden p-3 rounded-full hover:bg-white/10 transition-colors">
                    <svg className="w-6 h-6 text-[#f4ebe1]" fill="none" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" viewBox="0 0 24 24" stroke="currentColor">
                      {mobileMenuOpen ? <path d="M6 18L18 6M6 6l12 12" /> : <path d="M4 6h16M4 12h16M4 18h16" />}
                    </svg>
                  </button>
                </div>

                {mobileMenuOpen && (
                  <nav className="md:hidden mt-4 pb-4 space-y-2 animate-fade-in">
                    {navItems.map(({ id, label, icon: Icon, badge }) => (
                      <button key={id} onClick={() => { setView(id); setMobileMenuOpen(false); }} className={`w-full px-5 py-3 rounded-xl font-medium transition-all flex items-center gap-3 ${view === id ? 'bg-[#8b6f47] text-white shadow-lg' : 'text-[#f4ebe1]/80 bg-white/5 hover:bg-white/10'}`}>
                        <Icon />
                        {label}
                        {badge > 0 && <span className="ml-auto px-2 py-0.5 bg-[#059669] text-white rounded-full text-xs">{badge}</span>}
                      </button>
                    ))}
                  </nav>
                )}
              </div>
            </header>
          );
        }

        // ==================== DASHBOARD ====================
        function Dashboard({ setView, setSelectedZona }) {
          return (
            <div className="space-y-8 animate-fade-in">
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <StatCard icon="üìç" label="Zonas Activas" value={mockZonas.length} color="from-[#8b6f47] to-[#6b5437]" />
                <StatCard icon="üçÑ" label="Especies" value={mockEspecies.length} color="from-[#4a7c59] to-[#3a5c49]" />
                <StatCard icon="‚≠ê" label="Oportunidades" value={mockOportunidades.length} color="from-[#059669] to-[#047857]" />
                <StatCard icon="üéØ" label="Precisi√≥n IA" value="94%" color="from-[#d97706] to-[#b45309]" />
              </div>

              <section>
                <div className="flex items-center justify-between mb-6">
                  <h2 className="font-display text-3xl font-bold text-[#f4ebe1]">üåü Mejores Oportunidades</h2>
                  <button onClick={() => setView('zonas')} className="text-[#8b6f47] hover:text-[#f4ebe1] transition-colors text-sm font-medium">
                    Ver todas ‚Üí
                  </button>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  {mockOportunidades.map((op, idx) => (
                    <OportunidadCard key={idx} oportunidad={op} delay={idx * 0.1} onClick={() => setSelectedZona(mockZonas.find(z => z.id === op.zona_id))} />
                  ))}
                </div>
              </section>
            </div>
          );
        }

        function StatCard({ icon, label, value, color }) {
          return (
            <div className={`glass-effect rounded-2xl p-6 border border-[#8b6f47]/30 bg-gradient-to-br ${color} bg-opacity-10 transform hover:scale-105 transition-all duration-300 animate-fade-in`}>
              <div className="text-4xl mb-2">{icon}</div>
              <div className="text-3xl font-bold text-[#f4ebe1] mb-1">{value}</div>
              <div className="text-[#f4ebe1]/70 text-sm">{label}</div>
            </div>
          );
        }

        function OportunidadCard({ oportunidad, delay, onClick }) {
          const circumference = 2 * Math.PI * 45;
          const strokeDashoffset = circumference - (oportunidad.score_total / 100) * circumference;
          
          const getProbabilidadBadge = (prob) => {
            const styles = {
              excelente: 'bg-[#059669]/20 text-[#059669] border-[#059669]',
              muy_alta: 'bg-[#8b6f47]/20 text-[#8b6f47] border-[#8b6f47]',
              alta: 'bg-[#d97706]/20 text-[#d97706] border-[#d97706]'
            };
            return styles[prob] || styles.alta;
          };

          return (
            <div onClick={onClick} className="glass-effect rounded-2xl p-6 border border-[#8b6f47]/30 hover:border-[#8b6f47] cursor-pointer transition-all duration-300 hover:scale-105 animate-fade-in" style={{animationDelay: `${delay}s`}}>
              <div className="flex items-center justify-center mb-4">
                <div className="relative">
                  <svg className="transform -rotate-90" width="120" height="120">
                    <circle cx="60" cy="60" r="45" stroke="rgba(139, 111, 71, 0.2)" strokeWidth="8" fill="none" />
                    <circle cx="60" cy="60" r="45" stroke="#8b6f47" strokeWidth="8" fill="none" strokeDasharray={circumference} strokeDashoffset={strokeDashoffset} strokeLinecap="round" style={{transition: 'stroke-dashoffset 1s ease-out'}} />
                  </svg>
                  <div className="absolute inset-0 flex items-center justify-center">
                    <span className="text-3xl font-bold text-[#f4ebe1]">{Math.round(oportunidad.score_total)}</span>
                  </div>
                </div>
              </div>
              
              <h3 className="font-display text-lg font-bold text-[#f4ebe1] mb-1 text-center">{oportunidad.nombre_cientifico}</h3>
              <p className="text-[#8b6f47] text-sm text-center mb-3">{oportunidad.zona_nombre}</p>
              
              <div className={`w-full px-3 py-2 rounded-lg border text-center text-xs font-semibold mb-2 ${getProbabilidadBadge(oportunidad.probabilidad)}`}>
                {oportunidad.probabilidad.replace('_', ' ').toUpperCase()}
              </div>
              
              {oportunidad.dias_estimados_fructificacion && (
                <div className="text-center text-[#f4ebe1]/60 text-xs">
                  üìÖ ~{oportunidad.dias_estimados_fructificacion} d√≠as
                </div>
              )}
            </div>
          );
        }

        // ==================== SEGUIMIENTO ====================
        function Seguimiento({ zonasSeguidas, setZonasSeguidas, setSelectedZona }) {
          const eliminar = (id, e) => {
            e.stopPropagation();
            setZonasSeguidas(zonasSeguidas.filter(z => z.id !== id));
          };

          return (
            <div className="space-y-6 animate-fade-in">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h2 className="font-display text-3xl font-bold text-[#f4ebe1] mb-2">‚≠ê Mis Zonas Seguidas</h2>
                  <p className="text-[#f4ebe1]/60">Zonas que sigues para conocer las mejores condiciones de recolecci√≥n</p>
                </div>
              </div>

              {zonasSeguidas.length === 0 ? (
                <div className="glass-effect rounded-2xl p-12 border border-[#8b6f47]/30 text-center">
                  <div className="text-6xl mb-4">üìç</div>
                  <h3 className="font-display text-2xl font-bold text-[#f4ebe1] mb-3">No sigues ninguna zona todav√≠a</h3>
                  <p className="text-[#f4ebe1]/70 mb-6 max-w-md mx-auto">Ve a la secci√≥n de Zonas y haz click en la estrella (‚òÜ) para empezar a seguir zonas que te interesen.</p>
                </div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {zonasSeguidas.map((zona, idx) => (
                    <ZonaSeguida key={zona.id} zona={zona} onEliminar={eliminar} onClick={() => setSelectedZona(zona)} delay={idx * 0.1} />
                  ))}
                </div>
              )}

              {zonasSeguidas.length > 0 && (
                <div className="bg-[#4a7c59]/10 border border-[#4a7c59]/30 rounded-xl p-6">
                  <div className="flex items-start gap-3">
                    <span className="text-2xl">üí°</span>
                    <div>
                      <h4 className="font-semibold text-[#4a7c59] mb-2">Consejo: Mant√©n tus zonas actualizadas</h4>
                      <p className="text-[#f4ebe1]/80 text-sm">Haz click en cualquier zona para ver sus condiciones actuales, el term√≥metro de recolecci√≥n y qu√© setas est√°n disponibles ahora mismo.</p>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        }

        function ZonaSeguida({ zona, onEliminar, onClick, delay }) {
          const condiciones = {
            temperatura: (12 + Math.random() * 8).toFixed(1),
            precipitacion_14d: (30 + Math.random() * 50).toFixed(1),
            humedad: (70 + Math.random() * 20).toFixed(0),
            dias_sin_lluvia: Math.floor(Math.random() * 5),
            score_general: Math.floor(70 + Math.random() * 25)
          };

          const getEstado = (score) => {
            if (score >= 85) return { color: 'text-[#059669]', bgBar: 'bg-[#059669]', texto: 'Excelente' };
            if (score >= 70) return { color: 'text-[#8b6f47]', bgBar: 'bg-[#8b6f47]', texto: 'Muy bueno' };
            if (score >= 55) return { color: 'text-[#d97706]', bgBar: 'bg-[#d97706]', texto: 'Bueno' };
            return { color: 'text-[#dc2626]', bgBar: 'bg-[#dc2626]', texto: 'Regular' };
          };

          const estado = getEstado(condiciones.score_general);

          return (
            <div onClick={onClick} className="glass-effect rounded-2xl p-6 border border-[#8b6f47]/30 hover:border-[#8b6f47] cursor-pointer transition-all duration-300 hover:scale-105 animate-fade-in relative" style={{animationDelay: `${delay}s`}}>
              <button onClick={(e) => onEliminar(zona.id, e)} className="absolute top-4 right-4 p-2 rounded-full bg-white/10 hover:bg-[#dc2626]/20 text-[#f4ebe1]/60 hover:text-[#dc2626] transition-colors">
                <span className="text-lg">√ó</span>
              </button>

              <div className="mb-4 pr-10">
                <div className="flex items-center gap-2 mb-2">
                  <span className="text-2xl">‚≠ê</span>
                  <h3 className="font-display text-xl font-bold text-[#f4ebe1]">{zona.nombre}</h3>
                </div>
                <p className="text-[#8b6f47] text-sm">{zona.provincia} ¬∑ {zona.tipo_bosque}</p>
              </div>

              <div className="mb-4">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-[#f4ebe1]/70 text-sm">Estado actual:</span>
                  <span className={`font-bold ${estado.color}`}>{estado.texto}</span>
                </div>
                <div className="relative h-3 bg-white/10 rounded-full overflow-hidden">
                  <div className={`h-full ${estado.bgBar} transition-all duration-1000`} style={{width: `${condiciones.score_general}%`}} />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-3 mb-4">
                <div className="bg-white/5 rounded-lg p-3">
                  <div className="flex items-center gap-2 mb-1"><Cloud className="w-4 h-4 text-[#8b6f47]" /><span className="text-[#f4ebe1]/60 text-xs">Temperatura</span></div>
                  <div className="text-[#f4ebe1] font-semibold">{condiciones.temperatura}¬∞C</div>
                </div>
                <div className="bg-white/5 rounded-lg p-3">
                  <div className="flex items-center gap-2 mb-1"><Droplets className="w-4 h-4 text-[#4a7c59]" /><span className="text-[#f4ebe1]/60 text-xs">Precip. 14d</span></div>
                  <div className="text-[#f4ebe1] font-semibold">{condiciones.precipitacion_14d}mm</div>
                </div>
                <div className="bg-white/5 rounded-lg p-3">
                  <div className="text-[#f4ebe1]/60 text-xs mb-1">Humedad</div>
                  <div className="text-[#f4ebe1] font-semibold">{condiciones.humedad}%</div>
                </div>
                <div className="bg-white/5 rounded-lg p-3">
                  <div className="text-[#f4ebe1]/60 text-xs mb-1">Sin lluvia</div>
                  <div className="text-[#f4ebe1] font-semibold">{condiciones.dias_sin_lluvia} d√≠as</div>
                </div>
              </div>

              <div className="text-[#f4ebe1]/60 text-sm text-center pt-3 border-t border-[#8b6f47]/20">Click para ver detalles completos ‚Üí</div>
            </div>
          );
        }

        // ==================== ZONAS ====================
        function Zonas({ zonasSeguidas, setZonasSeguidas, setSelectedZona }) {
          const esSeguida = (id) => zonasSeguidas.some(z => z.id === id);
          
          const toggle = (zona, e) => {
            e.stopPropagation();
            if (esSeguida(zona.id)) {
              setZonasSeguidas(zonasSeguidas.filter(z => z.id !== zona.id));
            } else {
              setZonasSeguidas([...zonasSeguidas, zona]);
            }
          };

          return (
            <div className="space-y-6 animate-fade-in">
              <div className="flex items-center justify-between mb-6">
                <h2 className="font-display text-3xl font-bold text-[#f4ebe1]">üìç Todas las Zonas</h2>
                <p className="text-[#f4ebe1]/60 text-sm">{zonasSeguidas.length} zona{zonasSeguidas.length !== 1 ? 's' : ''} seguida{zonasSeguidas.length !== 1 ? 's' : ''}</p>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {mockZonas.map((zona, idx) => (
                  <div key={zona.id} className="glass-effect rounded-2xl p-6 border border-[#8b6f47]/30 hover:border-[#8b6f47]/60 transition-all duration-300 relative" style={{animationDelay: `${idx * 0.05}s`}}>
                    <button onClick={(e) => toggle(zona, e)} className={`absolute top-4 right-4 p-2 rounded-full transition-all ${esSeguida(zona.id) ? 'bg-[#059669] text-white hover:bg-[#059669]/80' : 'bg-white/10 text-[#f4ebe1]/60 hover:bg-white/20 hover:text-[#f4ebe1]'}`} title={esSeguida(zona.id) ? 'Dejar de seguir' : 'Seguir zona'}>
                      <span className="text-xl">{esSeguida(zona.id) ? '‚≠ê' : '‚òÜ'}</span>
                    </button>

                    <div onClick={() => setSelectedZona(zona)} className="cursor-pointer">
                      <div className="flex items-start justify-between mb-4 pr-10">
                        <div>
                          <h3 className="font-display text-xl font-bold text-[#f4ebe1] mb-1">{zona.nombre}</h3>
                          <p className="text-[#8b6f47] text-sm">{zona.comarca}</p>
                        </div>
                        <span className="px-3 py-1 bg-[#4a7c59]/20 text-[#4a7c59] rounded-full text-xs font-semibold">{zona.provincia}</span>
                      </div>

                      <div className="space-y-2 text-sm text-[#f4ebe1]/70">
                        <div className="flex items-center gap-2"><MapPin className="w-4 h-4 text-[#8b6f47]" />{zona.latitud.toFixed(4)}, {zona.longitud.toFixed(4)}</div>
                        <div className="flex items-center gap-2"><TrendingUp className="w-4 h-4 text-[#8b6f47]" />{zona.altitud}m ¬∑ {zona.tipo_bosque}</div>
                      </div>

                      <div className="mt-4 text-[#f4ebe1]/60 text-sm text-right">Click para ver calendario ‚Üí</div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          );
        }

        // ==================== ESPECIES ====================
        function Especies({ setSelectedEspecie }) {
          const getComestibilidadColor = (com) => {
            switch(com) {
              case 'excelente': return 'bg-[#059669]/20 text-[#059669]';
              case 'bueno': return 'bg-[#4a7c59]/20 text-[#4a7c59]';
              case 'toxico': case 'mortal': return 'bg-[#dc2626]/20 text-[#dc2626]';
              default: return 'bg-[#6b7280]/20 text-[#6b7280]';
            }
          };

          return (
            <div className="space-y-6 animate-fade-in">
              <h2 className="font-display text-3xl font-bold text-[#f4ebe1] mb-6">üçÑ Cat√°logo de Especies</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {mockEspecies.map((especie, idx) => (
                  <div key={especie.id} onClick={() => setSelectedEspecie(especie)} className="glass-effect rounded-2xl p-6 border border-[#8b6f47]/30 hover:border-[#8b6f47]/60 transition-all duration-300 cursor-pointer hover:scale-105" style={{animationDelay: `${idx * 0.1}s`}}>
                    <div className="flex items-start gap-4">
                      <div className="text-5xl">üçÑ</div>
                      <div className="flex-1">
                        <h3 className="font-display text-2xl font-bold text-[#f4ebe1] mb-2">{especie.nombre_cientifico}</h3>
                        <div className="flex flex-wrap gap-2 mb-4">
                          {especie.nombres_comunes.map((nombre, i) => (
                            <span key={i} className="text-[#8b6f47] text-sm">{nombre}{i < especie.nombres_comunes.length - 1 ? ',' : ''}</span>
                          ))}
                        </div>
                        <div className={`inline-block px-4 py-2 rounded-full text-sm font-semibold ${getComestibilidadColor(especie.comestibilidad)}`}>
                          {especie.comestibilidad.toUpperCase()}
                        </div>
                      </div>
                    </div>
                    <div className="mt-4 text-[#f4ebe1]/60 text-sm text-right">Click para ver ficha completa ‚Üí</div>
                  </div>
                ))}
              </div>
            </div>
          );
        }

        // ==================== ZONA MODAL CON PESTA√ëAS ====================
        function ZonaModal({ zona, onClose }) {
          const [tab, setTab] = useState('tiempo-real');
          const especiesZona = mockEspecies.filter(e => e.tipos_bosque && e.tipos_bosque.includes(zona.tipo_bosque));
          const meses = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
          const mesesCompletos = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];

          const condiciones = {
            temperatura: (12 + Math.random() * 8).toFixed(1),
            temp_suelo: (11 + Math.random() * 7).toFixed(1),
            precipitacion_14d: (30 + Math.random() * 50).toFixed(1),
            humedad: (70 + Math.random() * 20).toFixed(0),
            viento: (5 + Math.random() * 15).toFixed(0),
            dias_sin_lluvia: Math.floor(Math.random() * 5),
            score_general: Math.floor(70 + Math.random() * 25)
          };

          const mesActual = new Date().getMonth() + 1;
          const disponibles = especiesZona.filter(e => e.meses_fructificacion?.includes(mesActual)).map(e => ({
            ...e,
            score: Math.floor(65 + Math.random() * 30),
            dias_estimados: Math.floor(4 + Math.random() * 8)
          })).sort((a, b) => b.score - a.score);

          return (
            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 overflow-y-auto" onClick={onClose}>
              <div className="min-h-screen flex items-start justify-center p-4 py-8">
                <div className="glass-effect rounded-3xl border border-[#8b6f47]/30 max-w-6xl w-full p-6 md:p-8 my-8" onClick={e => e.stopPropagation()}>
                  <div className="flex items-start justify-between mb-6">
                    <div>
                      <h2 className="font-display text-3xl md:text-4xl font-bold text-[#f4ebe1] mb-2">{zona.nombre}</h2>
                      <div className="flex items-center gap-3 flex-wrap">
                        <span className="px-3 py-1 bg-[#4a7c59]/20 text-[#4a7c59] rounded-full text-sm font-semibold">{zona.provincia}</span>
                        <span className="text-[#f4ebe1]/60 text-sm">üå≤ {zona.tipo_bosque} ¬∑ ‚õ∞Ô∏è {zona.altitud}m</span>
                      </div>
                    </div>
                    <button onClick={onClose} className="p-2 hover:bg-white/10 rounded-full transition-colors flex-shrink-0">
                      <span className="text-[#f4ebe1] text-3xl">√ó</span>
                    </button>
                  </div>

                  <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
                    <button onClick={() => setTab('tiempo-real')} className={`px-6 py-3 rounded-xl font-semibold transition-all whitespace-nowrap flex items-center gap-2 ${tab === 'tiempo-real' ? 'bg-[#8b6f47] text-white shadow-lg' : 'bg-white/5 text-[#f4ebe1]/70 hover:bg-white/10'}`}>
                      <Cloud className="w-5 h-5" /> Tiempo Real
                    </button>
                    <button onClick={() => setTab('calendario')} className={`px-6 py-3 rounded-xl font-semibold transition-all whitespace-nowrap ${tab === 'calendario' ? 'bg-[#8b6f47] text-white shadow-lg' : 'bg-white/5 text-[#f4ebe1]/70 hover:bg-white/10'}`}>
                      üìÖ Calendario
                    </button>
                    <button onClick={() => setTab('disponibles')} className={`px-6 py-3 rounded-xl font-semibold transition-all whitespace-nowrap flex items-center gap-2 ${tab === 'disponibles' ? 'bg-[#8b6f47] text-white shadow-lg' : 'bg-white/5 text-[#f4ebe1]/70 hover:bg-white/10'}`}>
                      üçÑ Disponibles
                      {disponibles.length > 0 && <span className="px-2 py-1 bg-[#059669] text-white rounded-full text-xs">{disponibles.length}</span>}
                    </button>
                  </div>

                  {tab === 'tiempo-real' && <TiempoRealTab condiciones={condiciones} zona={zona} />}
                  {tab === 'calendario' && <CalendarioTab especiesZona={especiesZona} meses={meses} mesesCompletos={mesesCompletos} />}
                  {tab === 'disponibles' && <DisponiblesTab disponibles={disponibles} />}
                </div>
              </div>
            </div>
          );
        }

        function TiempoRealTab({ condiciones, zona }) {
          const getEstado = (score) => {
            if (score >= 85) return { color: 'bg-[#059669]', emoji: 'üü¢', texto: 'EXCELENTE momento para recolectar', rec: '¬°Ve ahora! Las condiciones son √≥ptimas.' };
            if (score >= 70) return { color: 'bg-[#8b6f47]', emoji: 'üü°', texto: 'MUY BUEN momento para recolectar', rec: 'Buenas condiciones. Vale la pena planificar una salida.' };
            if (score >= 55) return { color: 'bg-[#d97706]', emoji: 'üü†', texto: 'Momento REGULAR', rec: 'Podr√≠as encontrar algo, pero no es el mejor momento.' };
            return { color: 'bg-[#dc2626]', emoji: 'üî¥', texto: 'MAL momento', rec: 'Espera a que mejoren las condiciones.' };
          };
          const estado = getEstado(condiciones.score_general);

          return (
            <div className="space-y-6">
              <div className="bg-gradient-to-br from-white/5 to-white/10 rounded-2xl p-8 border-2 border-[#8b6f47]/30">
                <h3 className="font-display text-2xl font-bold text-[#f4ebe1] mb-4 flex items-center gap-2">
                  <span>üìä</span> Term√≥metro de Recolecci√≥n
                </h3>
                <div className="relative h-16 bg-white/10 rounded-full overflow-hidden mb-6 shadow-inner">
                  <div className={`h-full ${estado.color} transition-all duration-1000 flex items-center justify-end pr-6`} style={{width: `${condiciones.score_general}%`}}>
                    <span className="text-white font-bold text-3xl">{condiciones.score_general}</span>
                  </div>
                </div>
                <div className="flex items-center gap-4">
                  <span className="text-5xl">{estado.emoji}</span>
                  <div>
                    <div className={`font-bold text-2xl mb-1 ${estado.color.replace('bg-', 'text-')}`}>{estado.texto}</div>
                    <p className="text-[#f4ebe1]/80 text-lg">{estado.rec}</p>
                  </div>
                </div>
              </div>

              <div>
                <h3 className="font-display text-2xl font-bold text-[#f4ebe1] mb-4">Condiciones Actuales</h3>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  {[
                    { icon: <Cloud className="w-6 h-6 text-[#8b6f47]" />, label: 'Temperatura', value: `${condiciones.temperatura}¬∞C`, sub: 'Aire' },
                    { icon: <TrendingUp className="w-6 h-6 text-[#4a7c59]" />, label: 'Temp. Suelo', value: `${condiciones.temp_suelo}¬∞C`, sub: 'Estimada 10cm' },
                    { icon: <Droplets className="w-6 h-6 text-[#4a7c59]" />, label: 'Precipitaci√≥n', value: `${condiciones.precipitacion_14d}mm`, sub: '√öltimos 14 d√≠as' },
                    { label: 'Humedad', value: `${condiciones.humedad}%`, sub: 'Relativa' },
                    { label: 'Viento', value: `${condiciones.viento} km/h`, sub: 'Actual' },
                    { label: 'Sin lluvia', value: `${condiciones.dias_sin_lluvia} d√≠as`, sub: 'Consecutivos' },
                    { icon: <MapPin className="w-6 h-6 text-[#4a7c59]" />, label: 'Altitud', value: `${zona.altitud}m`, sub: 'Zona' }
                  ].map((c, i) => (
                    <div key={i} className="bg-white/5 rounded-xl p-4 border border-[#8b6f47]/20">
                      {c.icon && <div className="mb-2">{c.icon}</div>}
                      <div className="text-[#f4ebe1]/70 text-sm mb-1">{c.label}</div>
                      <div className="text-2xl font-bold text-[#f4ebe1] mb-1">{c.value}</div>
                      <div className="text-[#f4ebe1]/50 text-xs">{c.sub}</div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          );
        }

        function CalendarioTab({ especiesZona, meses, mesesCompletos }) {
          const fructifica = (e, mes) => e.meses_fructificacion?.includes(mes);
          const getColor = (com) => {
            const c = { excelente: 'bg-[#059669] text-white', bueno: 'bg-[#4a7c59] text-white', toxico: 'bg-[#dc2626] text-white' };
            return c[com] || 'bg-[#6b7280] text-white';
          };

          return (
            <div className="space-y-6">
              <h3 className="font-display text-2xl font-bold text-[#f4ebe1]">üìÖ Calendario de Fructificaci√≥n</h3>
              <div className="space-y-4">
                {especiesZona.map(e => (
                  <div key={e.id} className="bg-white/5 rounded-xl p-4 border border-[#8b6f47]/30">
                    <div className="flex items-center gap-3 mb-3">
                      <span className="text-2xl">üçÑ</span>
                      <div className="flex-1">
                        <div className="font-semibold text-[#f4ebe1] mb-1">{e.nombre_cientifico}</div>
                        <div className={`inline-block px-2 py-1 rounded text-xs font-semibold ${getColor(e.comestibilidad)}`}>
                          {e.comestibilidad === 'excelente' ? '‚≠ê' : e.comestibilidad === 'bueno' ? '‚úì' : '‚ö†'}
                        </div>
                      </div>
                    </div>
                    <div className="grid grid-cols-6 md:grid-cols-12 gap-2">
                      {meses.map((m, i) => (
                        <div key={i} className={`text-center py-2 rounded text-xs font-medium ${fructifica(e, i+1) ? 'bg-[#059669] text-white' : 'bg-white/5 text-[#f4ebe1]/40'}`}>{m}</div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          );
        }

        function DisponiblesTab({ disponibles }) {
          const getColor = (score) => {
            if (score >= 85) return 'text-[#059669] bg-[#059669]/10';
            if (score >= 70) return 'text-[#8b6f47] bg-[#8b6f47]/10';
            return 'text-[#d97706] bg-[#d97706]/10';
          };

          return (
            <div className="space-y-6">
              <h3 className="font-display text-2xl font-bold text-[#f4ebe1]">üçÑ Disponibles Ahora</h3>
              {disponibles.length === 0 ? (
                <div className="text-center py-12 bg-white/5 rounded-2xl">
                  <div className="text-6xl mb-4">üçÇ</div>
                  <h4 className="font-semibold text-xl text-[#f4ebe1] mb-2">No hay especies disponibles</h4>
                  <p className="text-[#f4ebe1]/60">La √©poca actual no coincide con per√≠odos de fructificaci√≥n.</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {disponibles.map((e, i) => (
                    <div key={e.id} className="bg-white/5 rounded-xl p-6 border border-[#8b6f47]/30 flex items-start gap-4">
                      <div className="text-5xl">üçÑ</div>
                      <div className="flex-1">
                        <div className="flex justify-between items-start mb-3">
                          <h4 className="font-display text-xl font-bold text-[#f4ebe1]">{e.nombre_cientifico}</h4>
                          <div className="text-right">
                            <div className="text-3xl font-bold text-[#f4ebe1]">{e.score}</div>
                            <div className={`text-sm font-semibold px-3 py-1 rounded-full ${getColor(e.score)}`}>
                              {e.score >= 85 ? 'Excelente' : e.score >= 70 ? 'Muy alta' : 'Alta'}
                            </div>
                          </div>
                        </div>
                        <div className="grid grid-cols-3 gap-4 text-sm">
                          <div className="bg-white/5 rounded p-2">
                            <div className="text-[#f4ebe1]/60 text-xs">D√≠as est.</div>
                            <div className="font-semibold">~{e.dias_estimados} d√≠as</div>
                          </div>
                          <div className="bg-white/5 rounded p-2">
                            <div className="text-[#f4ebe1]/60 text-xs">Comestibilidad</div>
                            <div className="font-semibold text-[#059669]">{e.comestibilidad === 'excelente' ? '‚≠ê Excelente' : '‚úì Bueno'}</div>
                          </div>
                          <div className="bg-white/5 rounded p-2">
                            <div className="text-[#f4ebe1]/60 text-xs">H√°bitat</div>
                            <div className="font-semibold">{e.tipos_bosque?.[0]}</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          );
        }

        // ==================== ESPECIE MODAL ====================
        function EspecieModal({ especie, onClose }) {
          const meses = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
          const getInfo = (com) => {
            const info = {
              excelente: { color: 'text-[#059669]', bg: 'bg-[#059669]/10', border: 'border-[#059669]', icon: '‚úì‚úì‚úì', texto: 'EXCELENTE COMESTIBLE', desc: 'Seta de alt√≠sima calidad gastron√≥mica.' },
              bueno: { color: 'text-[#4a7c59]', bg: 'bg-[#4a7c59]/10', border: 'border-[#4a7c59]', icon: '‚úì‚úì', texto: 'BUEN COMESTIBLE', desc: 'Seta comestible de buena calidad.' },
              toxico: { color: 'text-[#dc2626]', bg: 'bg-[#dc2626]/10', border: 'border-[#dc2626]', icon: '‚úó', texto: 'T√ìXICA', desc: 'NO CONSUMIR. Causa intoxicaci√≥n.' }
            };
            return info[com] || info.toxico;
          };
          const info = getInfo(especie.comestibilidad);

          return (
            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 overflow-y-auto" onClick={onClose}>
              <div className="min-h-screen flex items-start justify-center p-4 py-8">
                <div className="glass-effect rounded-3xl border border-[#8b6f47]/30 max-w-4xl w-full p-8 my-8" onClick={e => e.stopPropagation()}>
                  <div className="flex items-start justify-between mb-8">
                    <div className="flex-1">
                      <div className="flex items-center gap-4 mb-4">
                        <div className="text-6xl">üçÑ</div>
                        <div>
                          <h2 className="font-display text-4xl font-bold text-[#f4ebe1] mb-2">{especie.nombre_cientifico}</h2>
                          <p className="text-[#8b6f47] text-lg italic">Familia: {especie.familia}</p>
                        </div>
                      </div>

                      {especie.nombres_comunes && especie.nombres_comunes.length > 0 && (
                        <div className="mb-3">
                          <p className="text-[#f4ebe1]/70 text-sm mb-2">Tambi√©n conocida como:</p>
                          <div className="flex flex-wrap gap-2">
                            {especie.nombres_comunes.map((s, i) => (
                              <span key={i} className="px-3 py-1 bg-[#8b6f47]/20 text-[#8b6f47] rounded-full text-sm">{s}</span>
                            ))}
                          </div>
                        </div>
                      )}

                      <div className={`inline-flex items-center gap-3 px-6 py-4 rounded-xl border-2 ${info.border} ${info.bg}`}>
                        <span className="text-3xl">{info.icon}</span>
                        <div>
                          <div className={`font-bold text-xl ${info.color}`}>{info.texto}</div>
                          <div className={`text-sm ${info.color}`}>{info.desc}</div>
                        </div>
                      </div>
                    </div>

                    <button onClick={onClose} className="p-2 hover:bg-white/10 rounded-full transition-colors flex-shrink-0">
                      <span className="text-[#f4ebe1] text-3xl">√ó</span>
                    </button>
                  </div>

                  <div className="space-y-6">
                    {especie.tipos_bosque && (
                      <div className="bg-white/5 rounded-xl p-4">
                        <h3 className="font-bold text-[#8b6f47] mb-2">üå≤ H√°bitat</h3>
                        <div className="flex flex-wrap gap-2">
                          {especie.tipos_bosque.map((b, i) => (
                            <span key={i} className="px-3 py-1 bg-[#4a7c59]/20 text-[#4a7c59] rounded-full text-sm">{b}</span>
                          ))}
                        </div>
                      </div>
                    )}

                    {especie.meses_fructificacion && (
                      <div className="bg-white/5 rounded-xl p-4">
                        <h3 className="font-bold text-[#8b6f47] mb-3">üìÖ √âpoca de Fructificaci√≥n</h3>
                        <div className="grid grid-cols-6 gap-2">
                          {meses.map((m, i) => (
                            <div key={i} className={`text-center py-2 rounded text-sm font-medium ${especie.meses_fructificacion.includes(i+1) ? 'bg-[#059669] text-white' : 'bg-white/5 text-[#f4ebe1]/40'}`}>{m}</div>
                          ))}
                        </div>
                      </div>
                    )}

                    {especie.comestibilidad === 'toxico' && (
                      <div className="bg-[#dc2626]/20 border-2 border-[#dc2626] rounded-xl p-6">
                        <div className="flex items-start gap-4">
                          <span className="text-4xl">‚ö†Ô∏è</span>
                          <div>
                            <h4 className="text-[#dc2626] font-bold text-xl mb-2">ADVERTENCIA IMPORTANTE</h4>
                            <p className="text-[#f4ebe1]/90">Esta especie es T√ìXICA. Nunca la consumas bajo ninguna circunstancia. Puede causar intoxicaci√≥n grave.</p>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>

                  <div className="mt-8 pt-6 border-t border-[#8b6f47]/30">
                    <p className="text-[#f4ebe1]/60 text-sm text-center">‚ö†Ô∏è Esta ficha es orientativa. Consulta siempre con un mic√≥logo experto antes de consumir cualquier seta silvestre.</p>
                  </div>
                </div>
              </div>
            </div>
          );
        }

        // ==================== RENDER ====================
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
